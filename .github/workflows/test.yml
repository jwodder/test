name: Test

on:
  push:
    braches:
      - master
  pull_request:

defaults:
  run:
    shell: bash

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          #- windows-latest
          - ubuntu-latest
          #- macos-latest
        envs:
          - TEST_FOO: apple
            TEST_BAR: banana
            TEST_QUUX: mango
          - TEST_FOO: raddish
            TEST_GLARCH: kumquat
          - TEST_MAGIC: 'foo\nbar'
            TEST_APOS: "foo'bar"
            TEST_QUOTE: 'foo"bar'
    steps:
      #- name: Checkout this repository
      #  uses: actions/checkout@v4

      - name: Set envvars
        run: jq -r 'to_entries[] | "\(.key)=\(.value)"' <<<"$ENVS" >> "$GITHUB_ENV"
        env:
          ENVS: ${{ toJSON(matrix.envs) }}

      - name: Show envvars
        run: env | grep ^TEST_
